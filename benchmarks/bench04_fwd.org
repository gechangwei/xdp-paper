* Layer3 routing test
We use the xdp_fwd routing table helper for these benchmarks, compare with
baseline Linux.

: ./xdp_fwd -D ens1f1

Measure throughput with ethtool_stats.pl (rx_xdp_redirect /sec). Adapter RX ring
set to different values:

: ethtool -G ens1f1 rx X

** Data

#+NAME: fwd_data
| Cores | Linux (single route) | Linux (full table) | XDP (single route rxring 1024) | XDP (single route rxring 512) | XDP (single route rxring 256) | XDP (full table) |
|-------+----------------------+--------------------+--------------------------------+-------------------------------+-------------------------------+------------------|
|     1 |              1739672 |                  0 |                        5211477 |                       5357696 |                       5355583 |                0 |
|     2 |              3370584 |                  0 |                       10239315 |                      10570550 |                      10652337 |                0 |
|     3 |              4976559 |                  0 |                       13731038 |                      15722609 |                      15944586 |                0 |
|     4 |              6488625 |                  0 |                       16393261 |                      20192727 |                      21130579 |                0 |
|     5 |              7848970 |                  0 |                       19364863 |                      23225298 |                      25735339 |                0 |
|     6 |              9285971 |                  0 |                       22852944 |                      25916115 |                      30076644 |                0 |


#+BEGIN_SRC ipython :session :exports both :results raw drawer :var data=fwd_data
d = np.array(data)
plt.plot(d[:,0], d[:,5]/10**6, marker='o', label="XDP (single route)")
plt.plot(d[:,0], d[:,1]/10**6, marker='^', label="Linux (single route)")
plt.xlabel("Number of cores")
plt.ylabel("Mpps")
plt.legend()
plt.savefig(BASEDIR+"/figures/router-fwd.pdf", bbox_inches='tight')
plt.show()
#+END_SRC

#+RESULTS:
:results:
# Out[47]:
[[file:./obipy-resources/44kk7j.svg]]
:end:
